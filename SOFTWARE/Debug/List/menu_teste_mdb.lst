###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.50.3.4676/W32 for ARM      13/Sep/2017  16:35:19 #
# Copyright 1999-2013 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  C:\repositorios\MaisPipocaG2\SOFTWARE\Aplicacao\menu_tes #
#                    te_mdb.c                                                 #
#    Command line =  C:\repositorios\MaisPipocaG2\SOFTWARE\Aplicacao\menu_tes #
#                    te_mdb.c -lC C:\repositorios\MaisPipocaG2\SOFTWARE\Debug #
#                    \List\ -lA C:\repositorios\MaisPipocaG2\SOFTWARE\Debug\L #
#                    ist\ -o C:\repositorios\MaisPipocaG2\SOFTWARE\Debug\Obj\ #
#                     --no_cse --no_unroll --no_inline --no_code_motion       #
#                    --no_tbaa --no_clustering --no_scheduling --debug        #
#                    --endian=little --cpu=Cortex-M3 -e --fpu=None            #
#                    --dlib_config "C:\Program Files (x86)\IAR                #
#                    Systems\Embedded Workbench 6.5\arm\INC\c\DLib_Config_Nor #
#                    mal.h" -On                                               #
#    List file    =  C:\repositorios\MaisPipocaG2\SOFTWARE\Debug\List\menu_te #
#                    ste_mdb.lst                                              #
#    Object file  =  C:\repositorios\MaisPipocaG2\SOFTWARE\Debug\Obj\menu_tes #
#                    te_mdb.o                                                 #
#                                                                             #
#                                                                             #
###############################################################################

C:\repositorios\MaisPipocaG2\SOFTWARE\Aplicacao\menu_teste_mdb.c
      1          /*__________________________________________________________________________________
      2          |	DEXTRO SOLUÇÕES TECNOLÓGICAS
      3          |       
      4          |       ITAJAÍ - SC
      5          |       www.dextro.ind.br
      6          | __________________________________________________________________________________
      7          |
      8          |       This source code was developed by DEXTRO  and cannot be copied, in part 
      9          |       or in whole, or used, except when legally licensed by DEXTRO 
     10          |       or its distributors.
     11          |
     12          |       Este código é propriedade da DEXTRO  e não pode ser copiado, em parte 
     13          |       ou em todo, ou utilizado, exceto quando for legalmente licenciado pela 
     14          |       DEXTRO  ou por um de seus distribuidores.
     15          | __________________________________________________________________________________
     16          |
     17          |       Arquivo            :  menu_teste_mdb.c
     18          |       Descrição          :  Menu para realizar o teste dos dispositivos MDB
     19          | 
     20          |       Autor              :  Marcos Aquino
     21          |       Data criação       :  28/02/2017
     22          |
     23          |       Revisões           :  1.0.0.0
     24          |
     25          |
     26          | __________________________________________________________________________________
     27          */
     28          
     29          /***********************************************************************************
     30          *       Includes
     31          ***********************************************************************************/
     32          #include <stdio.h>
     33          #include <stdlib.h>
     34          #include <string.h>
     35          #include "..\includes.h"
     36          #include "menu_teste_mdb.h"
     37          #include "menu_ajuste_relogio.h"
     38          #include "menu_configuracao.h"
     39          #include "menu_edita_flag.h"
     40          #include "menu_edita_inteiro.h"
     41          #include "menu_edita_listagem.h"
     42          #include "menu_info_binaria.h"
     43          #include "menu_rolagem.h"
     44          #include "menu_teste_hardware.h"
     45          
     46          /***********************************************************************************
     47          *       Definições
     48          ***********************************************************************************/
     49          
     50          
     51          /***********************************************************************************
     52          *       Variaveis locais
     53          ***********************************************************************************/
     54          
     55          
     56          /************************************************************************************
     57          *       Funções locais
     58          ***********************************************************************************/
     59          void MTMDB_verifica_dispositivos(void);
     60          void MTMDB_teste_contagem_noteiro(void);
     61          void MTMDB_teste_contagem_moedeiro(void);
     62          void MTMDB_test_contagem_cartao(void);
     63          void MTMDB_libera_troco(void);
     64          
     65          /***********************************************************************************
     66          *       Tabela de funções
     67          ***********************************************************************************/

   \                                 In section .rodata, align 4
     68          void(*const MTMDB_func[])(void)={
   \                     MTMDB_func:
   \   00000000   0x........         DC32 MTMDB_verifica_dispositivos, MTMDB_teste_contagem_noteiro
   \              0x........   
   \   00000008   0x........         DC32 MTMDB_teste_contagem_moedeiro, MTMDB_test_contagem_cartao, 0H
   \              0x........   
   \              0x00000000   
     69            MTMDB_verifica_dispositivos,
     70            MTMDB_teste_contagem_noteiro,
     71            MTMDB_teste_contagem_moedeiro,
     72            MTMDB_test_contagem_cartao,
     73            NULL
     74          };
     75          
     76          /***********************************************************************************
     77          *       Implementação das funções
     78          ***********************************************************************************/
     79          
     80          /***********************************************************************************
     81          *       Descrição       :       Função principal do menu de teste 
     82          *                               do barramento MDB
     83          *       Parametros      :       nenhum
     84          *       Retorno         :       nenhum
     85          ***********************************************************************************/

   \                                 In section .text, align 2, keep-with-next
     86          void MTMDB_entry(void){
   \                     MTMDB_entry:
   \   00000000   0xB510             PUSH     {R4,LR}
     87            unsigned char idioma = APLICACAO_carrega_idioma();
   \   00000002   0x.... 0x....      BL       APLICACAO_carrega_idioma
   \   00000006   0x0004             MOVS     R4,R0
     88            
     89            MENUROLAGEM_show((char*)STRING_titulo_menu_mdb[idioma],
     90                             (char**)STRING_opcoes_menu_mdb[idioma],
     91                             TAM_OPCOES_MDB,
     92                             (void(**)(void))MTMDB_func); 
   \   00000008   0x....             LDR.N    R3,??DataTable4
   \   0000000A   0x2205             MOVS     R2,#+5
   \   0000000C   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   0000000E   0x2014             MOVS     R0,#+20
   \   00000010   0x....             LDR.N    R1,??DataTable4_1
   \   00000012   0xFB00 0x1104      MLA      R1,R0,R4,R1
   \   00000016   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   00000018   0x....             LDR.N    R0,??DataTable4_2
   \   0000001A   0xF850 0x0024      LDR      R0,[R0, R4, LSL #+2]
   \   0000001E   0x.... 0x....      BL       MENUROLAGEM_show
     93          }
   \   00000022   0xBD10             POP      {R4,PC}          ;; return
     94          /***********************************************************************************
     95          *       Descrição       :       Função para visualizar o flag de comunicação
     96          *                               dos dispositivos MDB
     97          *       Parametros      :       nenhum
     98          *       Retorno         :       nenhum
     99          ***********************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    100          void MTMDB_verifica_dispositivos(void){
   \                     MTMDB_verifica_dispositivos:
   \   00000000   0xE92D 0x41F0      PUSH     {R4-R8,LR}
   \   00000004   0xB086             SUB      SP,SP,#+24
    101            eTECLA tecla;
    102            unsigned char idioma = APLICACAO_carrega_idioma();
   \   00000006   0x.... 0x....      BL       APLICACAO_carrega_idioma
   \   0000000A   0x0005             MOVS     R5,R0
    103            char buffer_linha[17];
    104            
    105            SMDB_wait();
   \   0000000C   0x.... 0x....      BL       SMDB_wait
    106            
    107            STRING_write_to_internal(CLEAR_DISPLAY,(char*)STRING_titulo_teste_devices_mdb[idioma],NULL);    
   \   00000010   0x2200             MOVS     R2,#+0
   \   00000012   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000014   0x....             LDR.N    R0,??DataTable4_3
   \   00000016   0xF850 0x1025      LDR      R1,[R0, R5, LSL #+2]
   \   0000001A   0x2000             MOVS     R0,#+0
   \   0000001C   0x.... 0x....      BL       STRING_write_to_internal
    108            
    109            for(;;){
    110             
    111              tecla = TECLADO_getch();
   \                     ??MTMDB_verifica_dispositivos_0:
   \   00000020   0x.... 0x....      BL       TECLADO_getch
   \   00000024   0x0004             MOVS     R4,R0
    112              switch(tecla){
   \   00000026   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   00000028   0x2C01             CMP      R4,#+1
   \   0000002A   0xD006             BEQ.N    ??MTMDB_verifica_dispositivos_1
   \   0000002C   0xD309             BCC.N    ??MTMDB_verifica_dispositivos_2
   \   0000002E   0x2C03             CMP      R4,#+3
   \   00000030   0xD007             BEQ.N    ??MTMDB_verifica_dispositivos_3
   \   00000032   0xD305             BCC.N    ??MTMDB_verifica_dispositivos_4
   \   00000034   0x2C04             CMP      R4,#+4
   \   00000036   0xD104             BNE.N    ??MTMDB_verifica_dispositivos_2
    113                case TECLA_ENTER:
    114                     break;
   \                     ??MTMDB_verifica_dispositivos_5:
   \   00000038   0xE003             B.N      ??MTMDB_verifica_dispositivos_2
    115                case TECLA_ESC:
    116                     SMDB_release(); 
   \                     ??MTMDB_verifica_dispositivos_1:
   \   0000003A   0x.... 0x....      BL       SMDB_release
    117                     return;
   \   0000003E   0xE028             B.N      ??MTMDB_verifica_dispositivos_6
    118                case TECLA_INC:           
    119                     break;
   \                     ??MTMDB_verifica_dispositivos_4:
   \   00000040   0xE7FF             B.N      ??MTMDB_verifica_dispositivos_2
    120                case TECLA_DEC:
    121                     break;
    122              }
    123              
    124              eMDB_reply bill  = MDBILL_verifica_dispositivo();
   \                     ??MTMDB_verifica_dispositivos_3:
   \                     ??MTMDB_verifica_dispositivos_2:
   \   00000042   0x.... 0x....      BL       MDBILL_verifica_dispositivo
   \   00000046   0x0006             MOVS     R6,R0
    125              eMDB_reply coin  = MDBCOIN_get_device();
   \   00000048   0x.... 0x....      BL       MDBCOIN_get_device
   \   0000004C   0x0007             MOVS     R7,R0
    126              eMDB_reply cashless = CASHLESS_adreess();
   \   0000004E   0x.... 0x....      BL       CASHLESS_adreess
   \   00000052   0x4680             MOV      R8,R0
    127              
    128              sprintf(buffer_linha,"BV:%01d CA:%01d CD:%01d",bill==MDB_OK?1:0,coin==MDB_OK?1:0,cashless==MDB_OK?1:0);    
   \   00000054   0xFA5F 0xF888      UXTB     R8,R8            ;; ZeroExt  R8,R8,#+24,#+24
   \   00000058   0xF1B8 0x0F00      CMP      R8,#+0
   \   0000005C   0xD101             BNE.N    ??MTMDB_verifica_dispositivos_7
   \   0000005E   0x2001             MOVS     R0,#+1
   \   00000060   0xE000             B.N      ??MTMDB_verifica_dispositivos_8
   \                     ??MTMDB_verifica_dispositivos_7:
   \   00000062   0x2000             MOVS     R0,#+0
   \                     ??MTMDB_verifica_dispositivos_8:
   \   00000064   0xB2FF             UXTB     R7,R7            ;; ZeroExt  R7,R7,#+24,#+24
   \   00000066   0x2F00             CMP      R7,#+0
   \   00000068   0xD101             BNE.N    ??MTMDB_verifica_dispositivos_9
   \   0000006A   0x2301             MOVS     R3,#+1
   \   0000006C   0xE000             B.N      ??MTMDB_verifica_dispositivos_10
   \                     ??MTMDB_verifica_dispositivos_9:
   \   0000006E   0x2300             MOVS     R3,#+0
   \                     ??MTMDB_verifica_dispositivos_10:
   \   00000070   0xB2F6             UXTB     R6,R6            ;; ZeroExt  R6,R6,#+24,#+24
   \   00000072   0x2E00             CMP      R6,#+0
   \   00000074   0xD101             BNE.N    ??MTMDB_verifica_dispositivos_11
   \   00000076   0x2201             MOVS     R2,#+1
   \   00000078   0xE000             B.N      ??MTMDB_verifica_dispositivos_12
   \                     ??MTMDB_verifica_dispositivos_11:
   \   0000007A   0x2200             MOVS     R2,#+0
   \                     ??MTMDB_verifica_dispositivos_12:
   \   0000007C   0x9000             STR      R0,[SP, #+0]
   \   0000007E   0x....             LDR.N    R1,??DataTable4_4
   \   00000080   0xA801             ADD      R0,SP,#+4
   \   00000082   0x.... 0x....      BL       sprintf
    129              STRING_write_to_internal(NO_CLEAR,NULL,buffer_linha);
   \   00000086   0xAA01             ADD      R2,SP,#+4
   \   00000088   0x2100             MOVS     R1,#+0
   \   0000008A   0x2001             MOVS     R0,#+1
   \   0000008C   0x.... 0x....      BL       STRING_write_to_internal
   \   00000090   0xE7C6             B.N      ??MTMDB_verifica_dispositivos_0
    130            }     
   \                     ??MTMDB_verifica_dispositivos_6:
   \   00000092   0xB006             ADD      SP,SP,#+24
   \   00000094   0xE8BD 0x81F0      POP      {R4-R8,PC}       ;; return
    131          }
    132          /***********************************************************************************
    133          *       Descrição       :       Função para pegar o valor adicionado ao
    134          *                               noteiro MDB
    135          *       Parametros      :       nenhum
    136          *       Retorno         :       nenhum
    137          ***********************************************************************************/
    138          extern void SMDBILL_set_bloqueio(unsigned char bloqueio);

   \                                 In section .text, align 2, keep-with-next
    139          void MTMDB_teste_contagem_noteiro(void){
   \                     MTMDB_teste_contagem_noteiro:
   \   00000000   0xB5F0             PUSH     {R4-R7,LR}
   \   00000002   0xB085             SUB      SP,SP,#+20
    140            eTECLA tecla;
    141            unsigned char idioma = APLICACAO_carrega_idioma();
   \   00000004   0x.... 0x....      BL       APLICACAO_carrega_idioma
   \   00000008   0x0005             MOVS     R5,R0
    142            char buffer_linha[17];  
    143            unsigned char flag=0;
   \   0000000A   0x2600             MOVS     R6,#+0
    144            
    145            STRING_write_to_internal(CLEAR_DISPLAY,(char*)STRING_titulo_teste_bill_mdb[idioma],NULL);   
   \   0000000C   0x2200             MOVS     R2,#+0
   \   0000000E   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000010   0x....             LDR.N    R0,??DataTable4_5
   \   00000012   0xF850 0x1025      LDR      R1,[R0, R5, LSL #+2]
   \   00000016   0x2000             MOVS     R0,#+0
   \   00000018   0x.... 0x....      BL       STRING_write_to_internal
    146            
    147            for(;;){
    148              
    149              tecla = TECLADO_getch();
   \                     ??MTMDB_teste_contagem_noteiro_0:
   \   0000001C   0x.... 0x....      BL       TECLADO_getch
   \   00000020   0x0004             MOVS     R4,R0
    150              switch(tecla){
   \   00000022   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   00000024   0x2C01             CMP      R4,#+1
   \   00000026   0xD009             BEQ.N    ??MTMDB_teste_contagem_noteiro_1
   \   00000028   0xD314             BCC.N    ??MTMDB_teste_contagem_noteiro_2
   \   0000002A   0x2C03             CMP      R4,#+3
   \   0000002C   0xD00D             BEQ.N    ??MTMDB_teste_contagem_noteiro_3
   \   0000002E   0xD306             BCC.N    ??MTMDB_teste_contagem_noteiro_4
   \   00000030   0x2C04             CMP      R4,#+4
   \   00000032   0xD10F             BNE.N    ??MTMDB_teste_contagem_noteiro_2
    151                case TECLA_ENTER:
    152                     PAGAMENTOS_set_valores(0);
   \                     ??MTMDB_teste_contagem_noteiro_5:
   \   00000034   0x2000             MOVS     R0,#+0
   \   00000036   0x.... 0x....      BL       PAGAMENTOS_set_valores
    153                     break;
   \   0000003A   0xE00B             B.N      ??MTMDB_teste_contagem_noteiro_2
    154                case TECLA_ESC:
    155                     return;
   \                     ??MTMDB_teste_contagem_noteiro_1:
   \   0000003C   0xE01E             B.N      ??MTMDB_teste_contagem_noteiro_6
    156                case TECLA_INC:
    157                     flag = 1;
   \                     ??MTMDB_teste_contagem_noteiro_4:
   \   0000003E   0x2001             MOVS     R0,#+1
   \   00000040   0x0006             MOVS     R6,R0
    158                     SMDBILL_set_bloqueio(1);        
   \   00000042   0x2001             MOVS     R0,#+1
   \   00000044   0x.... 0x....      BL       SMDBILL_set_bloqueio
    159                     break;
   \   00000048   0xE004             B.N      ??MTMDB_teste_contagem_noteiro_2
    160                case TECLA_DEC:
    161                     flag = 0;
   \                     ??MTMDB_teste_contagem_noteiro_3:
   \   0000004A   0x2000             MOVS     R0,#+0
   \   0000004C   0x0006             MOVS     R6,R0
    162                     SMDBILL_set_bloqueio(0);        
   \   0000004E   0x2000             MOVS     R0,#+0
   \   00000050   0x.... 0x....      BL       SMDBILL_set_bloqueio
    163                     break;
    164              }
    165              
    166              unsigned int valor = PAGAMENTOS_get_valor_acumulado();
   \                     ??MTMDB_teste_contagem_noteiro_2:
   \   00000054   0x.... 0x....      BL       PAGAMENTOS_get_valor_acumulado
   \   00000058   0x0007             MOVS     R7,R0
    167              sprintf(buffer_linha,"%05d[%s]",valor,flag?" LOCK ":"UNLOCK");
   \   0000005A   0xB2F6             UXTB     R6,R6            ;; ZeroExt  R6,R6,#+24,#+24
   \   0000005C   0x2E00             CMP      R6,#+0
   \   0000005E   0xD001             BEQ.N    ??MTMDB_teste_contagem_noteiro_7
   \   00000060   0x....             LDR.N    R3,??DataTable4_6
   \   00000062   0xE000             B.N      ??MTMDB_teste_contagem_noteiro_8
   \                     ??MTMDB_teste_contagem_noteiro_7:
   \   00000064   0x....             LDR.N    R3,??DataTable4_7
   \                     ??MTMDB_teste_contagem_noteiro_8:
   \   00000066   0x003A             MOVS     R2,R7
   \   00000068   0x....             LDR.N    R1,??DataTable4_8
   \   0000006A   0xA800             ADD      R0,SP,#+0
   \   0000006C   0x.... 0x....      BL       sprintf
    168              STRING_write_to_internal(NO_CLEAR,NULL,buffer_linha);
   \   00000070   0xAA00             ADD      R2,SP,#+0
   \   00000072   0x2100             MOVS     R1,#+0
   \   00000074   0x2001             MOVS     R0,#+1
   \   00000076   0x.... 0x....      BL       STRING_write_to_internal
   \   0000007A   0xE7CF             B.N      ??MTMDB_teste_contagem_noteiro_0
    169            }  
   \                     ??MTMDB_teste_contagem_noteiro_6:
   \   0000007C   0xB005             ADD      SP,SP,#+20
   \   0000007E   0xBDF0             POP      {R4-R7,PC}       ;; return
    170          }
    171          /***********************************************************************************
    172          *       Descrição       :       Função para pegar o valor adicionar ao moedeiro
    173          *                               MDB
    174          *       Parametros      :       nenhum
    175          *       Retorno         :       nenhum
    176          ***********************************************************************************/
    177          extern void SMDBCOIN_set_flag_bloqueio(unsigned char flag);

   \                                 In section .text, align 2, keep-with-next
    178          void MTMDB_teste_contagem_moedeiro(void){
   \                     MTMDB_teste_contagem_moedeiro:
   \   00000000   0xB5F0             PUSH     {R4-R7,LR}
   \   00000002   0xB087             SUB      SP,SP,#+28
    179            eTECLA tecla;
    180            unsigned char idioma = APLICACAO_carrega_idioma();
   \   00000004   0x.... 0x....      BL       APLICACAO_carrega_idioma
   \   00000008   0x0005             MOVS     R5,R0
    181            char buffer_linha[17];  
    182            unsigned char flag=0;
   \   0000000A   0x2600             MOVS     R6,#+0
    183            
    184            STRING_write_to_internal(CLEAR_DISPLAY,(char*)STRING_titulo_teste_coin_mdb[idioma],NULL);   
   \   0000000C   0x2200             MOVS     R2,#+0
   \   0000000E   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000010   0x....             LDR.N    R0,??DataTable4_9
   \   00000012   0xF850 0x1025      LDR      R1,[R0, R5, LSL #+2]
   \   00000016   0x2000             MOVS     R0,#+0
   \   00000018   0x.... 0x....      BL       STRING_write_to_internal
    185            PAGAMENTOS_set_valores(0);
   \   0000001C   0x2000             MOVS     R0,#+0
   \   0000001E   0x.... 0x....      BL       PAGAMENTOS_set_valores
    186            
    187            for(;;){
    188              
    189              tecla = TECLADO_getch();
   \                     ??MTMDB_teste_contagem_moedeiro_0:
   \   00000022   0x.... 0x....      BL       TECLADO_getch
   \   00000026   0x0004             MOVS     R4,R0
    190              switch(tecla){
   \   00000028   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   0000002A   0x2C01             CMP      R4,#+1
   \   0000002C   0xD010             BEQ.N    ??MTMDB_teste_contagem_moedeiro_1
   \   0000002E   0xD31B             BCC.N    ??MTMDB_teste_contagem_moedeiro_2
   \   00000030   0x2C03             CMP      R4,#+3
   \   00000032   0xD014             BEQ.N    ??MTMDB_teste_contagem_moedeiro_3
   \   00000034   0xD30D             BCC.N    ??MTMDB_teste_contagem_moedeiro_4
   \   00000036   0x2C04             CMP      R4,#+4
   \   00000038   0xD116             BNE.N    ??MTMDB_teste_contagem_moedeiro_2
    191                case TECLA_ENTER:
    192                     MTMDB_libera_troco();
   \                     ??MTMDB_teste_contagem_moedeiro_5:
   \   0000003A   0x.... 0x....      BL       MTMDB_libera_troco
    193                     STRING_write_to_internal(CLEAR_DISPLAY,(char*)STRING_titulo_teste_coin_mdb[idioma],NULL);              
   \   0000003E   0x2200             MOVS     R2,#+0
   \   00000040   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000042   0x....             LDR.N    R0,??DataTable4_9
   \   00000044   0xF850 0x1025      LDR      R1,[R0, R5, LSL #+2]
   \   00000048   0x2000             MOVS     R0,#+0
   \   0000004A   0x.... 0x....      BL       STRING_write_to_internal
    194                     break;
   \   0000004E   0xE00B             B.N      ??MTMDB_teste_contagem_moedeiro_2
    195                case TECLA_ESC:
    196                     return;
   \                     ??MTMDB_teste_contagem_moedeiro_1:
   \   00000050   0xE026             B.N      ??MTMDB_teste_contagem_moedeiro_6
    197                case TECLA_INC:
    198                     flag = 1;
   \                     ??MTMDB_teste_contagem_moedeiro_4:
   \   00000052   0x2001             MOVS     R0,#+1
   \   00000054   0x0006             MOVS     R6,R0
    199                     SMDBCOIN_set_flag_bloqueio(1);        
   \   00000056   0x2001             MOVS     R0,#+1
   \   00000058   0x.... 0x....      BL       SMDBCOIN_set_flag_bloqueio
    200                     break;
   \   0000005C   0xE004             B.N      ??MTMDB_teste_contagem_moedeiro_2
    201                case TECLA_DEC:
    202                     flag = 0;
   \                     ??MTMDB_teste_contagem_moedeiro_3:
   \   0000005E   0x2000             MOVS     R0,#+0
   \   00000060   0x0006             MOVS     R6,R0
    203                     SMDBCOIN_set_flag_bloqueio(0);        
   \   00000062   0x2000             MOVS     R0,#+0
   \   00000064   0x.... 0x....      BL       SMDBCOIN_set_flag_bloqueio
    204                     break;
    205              }
    206              
    207              unsigned int valor = PAGAMENTOS_get_valor_acumulado();
   \                     ??MTMDB_teste_contagem_moedeiro_2:
   \   00000068   0x.... 0x....      BL       PAGAMENTOS_get_valor_acumulado
   \   0000006C   0x0007             MOVS     R7,R0
    208              sprintf(buffer_linha,"%04d,%02d[%s]",valor/100,valor%100,flag?" LOCK ":"UNLOCK");
   \   0000006E   0xB2F6             UXTB     R6,R6            ;; ZeroExt  R6,R6,#+24,#+24
   \   00000070   0x2E00             CMP      R6,#+0
   \   00000072   0xD001             BEQ.N    ??MTMDB_teste_contagem_moedeiro_7
   \   00000074   0x....             LDR.N    R0,??DataTable4_6
   \   00000076   0xE000             B.N      ??MTMDB_teste_contagem_moedeiro_8
   \                     ??MTMDB_teste_contagem_moedeiro_7:
   \   00000078   0x....             LDR.N    R0,??DataTable4_7
   \                     ??MTMDB_teste_contagem_moedeiro_8:
   \   0000007A   0x2164             MOVS     R1,#+100
   \   0000007C   0x9000             STR      R0,[SP, #+0]
   \   0000007E   0xFBB7 0xF0F1      UDIV     R0,R7,R1
   \   00000082   0xFB01 0x7310      MLS      R3,R1,R0,R7
   \   00000086   0x2064             MOVS     R0,#+100
   \   00000088   0xFBB7 0xF2F0      UDIV     R2,R7,R0
   \   0000008C   0x....             LDR.N    R1,??DataTable4_10
   \   0000008E   0xA801             ADD      R0,SP,#+4
   \   00000090   0x.... 0x....      BL       sprintf
    209              STRING_write_to_internal(NO_CLEAR,NULL,buffer_linha);
   \   00000094   0xAA01             ADD      R2,SP,#+4
   \   00000096   0x2100             MOVS     R1,#+0
   \   00000098   0x2001             MOVS     R0,#+1
   \   0000009A   0x.... 0x....      BL       STRING_write_to_internal
   \   0000009E   0xE7C0             B.N      ??MTMDB_teste_contagem_moedeiro_0
    210            }   
   \                     ??MTMDB_teste_contagem_moedeiro_6:
   \   000000A0   0xB007             ADD      SP,SP,#+28
   \   000000A2   0xBDF0             POP      {R4-R7,PC}       ;; return
    211          }
    212          /***********************************************************************************
    213          *       Descrição       :       Tela para o usuário selecionar quantas moedas
    214          *                               serão liberadas no troco
    215          *       Parametros      :       nenhum
    216          *       Retorno         :       nenhum
    217          ***********************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    218          void MTMDB_libera_troco(void){
   \                     MTMDB_libera_troco:
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0xB086             SUB      SP,SP,#+24
    219            BOARD_setter_general_purpose_counter(10000);
   \   00000004   0xF242 0x7010      MOVW     R0,#+10000
   \   00000008   0x.... 0x....      BL       BOARD_setter_general_purpose_counter
    220            eTECLA tecla;  
    221            unsigned char quantidade=1;
   \   0000000C   0x2501             MOVS     R5,#+1
    222            char buffer_linha[17];
    223            unsigned char idioma = APLICACAO_carrega_idioma();
   \   0000000E   0x.... 0x....      BL       APLICACAO_carrega_idioma
   \   00000012   0x0006             MOVS     R6,R0
    224              
    225            STRING_write_to_internal(CLEAR_DISPLAY,(char*)STRING_titulo_teste_coin_changer_mdb[idioma],NULL);     
   \   00000014   0x2200             MOVS     R2,#+0
   \   00000016   0xB2F6             UXTB     R6,R6            ;; ZeroExt  R6,R6,#+24,#+24
   \   00000018   0x....             LDR.N    R0,??DataTable4_11
   \   0000001A   0xF850 0x1026      LDR      R1,[R0, R6, LSL #+2]
   \   0000001E   0x2000             MOVS     R0,#+0
   \   00000020   0x.... 0x....      BL       STRING_write_to_internal
    226            for(;BOARD_getter_general_purpose_counter();){
   \                     ??MTMDB_libera_troco_0:
   \   00000024   0x.... 0x....      BL       BOARD_getter_general_purpose_counter
   \   00000028   0x2800             CMP      R0,#+0
   \   0000002A   0xD027             BEQ.N    ??MTMDB_libera_troco_1
    227              
    228              tecla = TECLADO_getch();
   \   0000002C   0x.... 0x....      BL       TECLADO_getch
   \   00000030   0x0004             MOVS     R4,R0
    229              switch(tecla){
   \   00000032   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \   00000034   0x2C01             CMP      R4,#+1
   \   00000036   0xD00B             BEQ.N    ??MTMDB_libera_troco_2
   \   00000038   0xD314             BCC.N    ??MTMDB_libera_troco_3
   \   0000003A   0x2C03             CMP      R4,#+3
   \   0000003C   0xD00E             BEQ.N    ??MTMDB_libera_troco_4
   \   0000003E   0xD308             BCC.N    ??MTMDB_libera_troco_5
   \   00000040   0x2C04             CMP      R4,#+4
   \   00000042   0xD10F             BNE.N    ??MTMDB_libera_troco_3
    230                case TECLA_ENTER:
    231                     MDB_coin_dispenser(2,quantidade);
   \                     ??MTMDB_libera_troco_6:
   \   00000044   0x0029             MOVS     R1,R5
   \   00000046   0xB2C9             UXTB     R1,R1            ;; ZeroExt  R1,R1,#+24,#+24
   \   00000048   0x2002             MOVS     R0,#+2
   \   0000004A   0x.... 0x....      BL       MDB_coin_dispenser
    232                     break;
   \   0000004E   0xE009             B.N      ??MTMDB_libera_troco_3
    233                case TECLA_ESC:
    234                     return;
   \                     ??MTMDB_libera_troco_2:
   \   00000050   0xE014             B.N      ??MTMDB_libera_troco_7
    235                case TECLA_INC:
    236                      if(quantidade<16)
   \                     ??MTMDB_libera_troco_5:
   \   00000052   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000054   0x2D10             CMP      R5,#+16
   \   00000056   0xDA00             BGE.N    ??MTMDB_libera_troco_8
    237                        quantidade++;
   \   00000058   0x1C6D             ADDS     R5,R5,#+1
    238                     break;
   \                     ??MTMDB_libera_troco_8:
   \   0000005A   0xE003             B.N      ??MTMDB_libera_troco_3
    239                case TECLA_DEC:
    240                     if(quantidade>1)
   \                     ??MTMDB_libera_troco_4:
   \   0000005C   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000005E   0x2D02             CMP      R5,#+2
   \   00000060   0xDB00             BLT.N    ??MTMDB_libera_troco_9
    241                       quantidade--;
   \   00000062   0x1E6D             SUBS     R5,R5,#+1
    242                     break;
    243              }        
    244              
    245              sprintf(buffer_linha,"Moedas:%02d",quantidade);
   \                     ??MTMDB_libera_troco_9:
   \                     ??MTMDB_libera_troco_3:
   \   00000064   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000066   0x002A             MOVS     R2,R5
   \   00000068   0x....             LDR.N    R1,??DataTable4_12
   \   0000006A   0xA800             ADD      R0,SP,#+0
   \   0000006C   0x.... 0x....      BL       sprintf
    246              STRING_write_to_internal(NO_CLEAR,NULL,buffer_linha);    
   \   00000070   0xAA00             ADD      R2,SP,#+0
   \   00000072   0x2100             MOVS     R1,#+0
   \   00000074   0x2001             MOVS     R0,#+1
   \   00000076   0x.... 0x....      BL       STRING_write_to_internal
   \   0000007A   0xE7D3             B.N      ??MTMDB_libera_troco_0
    247            }  
    248          }
   \                     ??MTMDB_libera_troco_1:
   \                     ??MTMDB_libera_troco_7:
   \   0000007C   0xB006             ADD      SP,SP,#+24
   \   0000007E   0xBD70             POP      {R4-R6,PC}       ;; return
    249          /***********************************************************************************
    250          *       Descrição       :       Função para pegar o valor adicionar ao cartão
    251          *       Parametros      :       nenhum
    252          *       Retorno         :       nenhum
    253          ***********************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    254          void MTMDB_test_contagem_cartao(void){
    255            
    256            
    257          }
   \                     MTMDB_test_contagem_cartao:
   \   00000000   0x4770             BX       LR               ;; return

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4:
   \   00000000   0x........         DC32     MTMDB_func

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_1:
   \   00000000   0x........         DC32     STRING_opcoes_menu_mdb

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_2:
   \   00000000   0x........         DC32     STRING_titulo_menu_mdb

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_3:
   \   00000000   0x........         DC32     STRING_titulo_teste_devices_mdb

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_4:
   \   00000000   0x........         DC32     `?<Constant "BV:%01d CA:%01d CD:%01d">`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_5:
   \   00000000   0x........         DC32     STRING_titulo_teste_bill_mdb

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_6:
   \   00000000   0x........         DC32     `?<Constant " LOCK ">`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_7:
   \   00000000   0x........         DC32     `?<Constant "UNLOCK">`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_8:
   \   00000000   0x........         DC32     `?<Constant "%05d[%s]">`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_9:
   \   00000000   0x........         DC32     STRING_titulo_teste_coin_mdb

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_10:
   \   00000000   0x........         DC32     `?<Constant "%04d,%02d[%s]">`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_11:
   \   00000000   0x........         DC32     STRING_titulo_teste_coin_changer_mdb

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_12:
   \   00000000   0x........         DC32     `?<Constant "Moedas:%02d">`

   \                                 In section .rodata, align 4
   \                     `?<Constant "BV:%01d CA:%01d CD:%01d">`:
   \   00000000   0x42 0x56          DC8 "BV:%01d CA:%01d CD:%01d"
   \              0x3A 0x25    
   \              0x30 0x31    
   \              0x64 0x20    
   \              0x43 0x41    
   \              0x3A 0x25    
   \              0x30 0x31    
   \              0x64 0x20    
   \              0x43 0x44    
   \              0x3A 0x25    
   \              0x30 0x31    
   \              0x64 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "%05d[%s]">`:
   \   00000000   0x25 0x30          DC8 "%05d[%s]"
   \              0x35 0x64    
   \              0x5B 0x25    
   \              0x73 0x5D    
   \              0x00         
   \   00000009   0x00 0x00          DC8 0, 0, 0
   \              0x00         

   \                                 In section .rodata, align 4
   \                     `?<Constant " LOCK ">`:
   \   00000000   0x20 0x4C          DC8 " LOCK "
   \              0x4F 0x43    
   \              0x4B 0x20    
   \              0x00         
   \   00000007   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "UNLOCK">`:
   \   00000000   0x55 0x4E          DC8 "UNLOCK"
   \              0x4C 0x4F    
   \              0x43 0x4B    
   \              0x00         
   \   00000007   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "%04d,%02d[%s]">`:
   \   00000000   0x25 0x30          DC8 "%04d,%02d[%s]"
   \              0x34 0x64    
   \              0x2C 0x25    
   \              0x30 0x32    
   \              0x64 0x5B    
   \              0x25 0x73    
   \              0x5D 0x00    
   \   0000000E   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "Moedas:%02d">`:
   \   00000000   0x4D 0x6F          DC8 "Moedas:%02d"
   \              0x65 0x64    
   \              0x61 0x73    
   \              0x3A 0x25    
   \              0x30 0x32    
   \              0x64 0x00    
    258          /***********************************************************************************
    259          *       Fim do arquivo
    260          ***********************************************************************************/

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       8   MTMDB_entry
         8   -> APLICACAO_carrega_idioma
         8   -> MENUROLAGEM_show
      40   MTMDB_libera_troco
        40   -> APLICACAO_carrega_idioma
        40   -> BOARD_getter_general_purpose_counter
        40   -> BOARD_setter_general_purpose_counter
        40   -> MDB_coin_dispenser
        40   -> STRING_write_to_internal
        40   -> TECLADO_getch
        40   -> sprintf
       0   MTMDB_test_contagem_cartao
      48   MTMDB_teste_contagem_moedeiro
        48   -> APLICACAO_carrega_idioma
        48   -> MTMDB_libera_troco
        48   -> PAGAMENTOS_get_valor_acumulado
        48   -> PAGAMENTOS_set_valores
        48   -> SMDBCOIN_set_flag_bloqueio
        48   -> STRING_write_to_internal
        48   -> TECLADO_getch
        48   -> sprintf
      40   MTMDB_teste_contagem_noteiro
        40   -> APLICACAO_carrega_idioma
        40   -> PAGAMENTOS_get_valor_acumulado
        40   -> PAGAMENTOS_set_valores
        40   -> SMDBILL_set_bloqueio
        40   -> STRING_write_to_internal
        40   -> TECLADO_getch
        40   -> sprintf
      48   MTMDB_verifica_dispositivos
        48   -> APLICACAO_carrega_idioma
        48   -> CASHLESS_adreess
        48   -> MDBCOIN_get_device
        48   -> MDBILL_verifica_dispositivo
        48   -> SMDB_release
        48   -> SMDB_wait
        48   -> STRING_write_to_internal
        48   -> TECLADO_getch
        48   -> sprintf


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       8  ?<Constant " LOCK ">
      16  ?<Constant "%04d,%02d[%s]">
      12  ?<Constant "%05d[%s]">
      24  ?<Constant "BV:%01d CA:%01d CD:%01d">
      12  ?<Constant "Moedas:%02d">
       8  ?<Constant "UNLOCK">
       4  ??DataTable4
       4  ??DataTable4_1
       4  ??DataTable4_10
       4  ??DataTable4_11
       4  ??DataTable4_12
       4  ??DataTable4_2
       4  ??DataTable4_3
       4  ??DataTable4_4
       4  ??DataTable4_5
       4  ??DataTable4_6
       4  ??DataTable4_7
       4  ??DataTable4_8
       4  ??DataTable4_9
      36  MTMDB_entry
      20  MTMDB_func
     128  MTMDB_libera_troco
       2  MTMDB_test_contagem_cartao
     164  MTMDB_teste_contagem_moedeiro
     128  MTMDB_teste_contagem_noteiro
     152  MTMDB_verifica_dispositivos

 
 100 bytes in section .rodata
 662 bytes in section .text
 
 662 bytes of CODE  memory
 100 bytes of CONST memory

Errors: none
Warnings: none
