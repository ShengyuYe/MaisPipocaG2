###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.50.3.4676/W32 for ARM      06/Jul/2017  16:39:46 #
# Copyright 1999-2013 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Aplicacao\menu_edita_inteiro.c            #
#    Command line =  C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Aplicacao\menu_edita_inteiro.c -lC        #
#                    C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\List\ -lA                           #
#                    C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\List\ -o                            #
#                    C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\Obj\ --no_cse --no_unroll           #
#                    --no_inline --no_code_motion --no_tbaa --no_clustering   #
#                    --no_scheduling --debug --endian=little --cpu=Cortex-M3  #
#                    -e --fpu=None --dlib_config "C:\Program Files (x86)\IAR  #
#                    Systems\Embedded Workbench 6.5\arm\INC\c\DLib_Config_Nor #
#                    mal.h" -Ol                                               #
#    List file    =  C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\List\menu_edita_inteiro.lst         #
#    Object file  =  C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\Obj\menu_edita_inteiro.o            #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPipocaG2\SOFTWARE\Aplicacao\menu_edita_inteiro.c
      1          /*__________________________________________________________________________________
      2          |	DEXTRO SOLUÇÕES TECNOLÓGICAS
      3          |       
      4          |       ITAJAÍ - SC
      5          |       www.dextro.ind.br
      6          | __________________________________________________________________________________
      7          |
      8          |       This source code was developed by DEXTRO  and cannot be copied, in part 
      9          |       or in whole, or used, except when legally licensed by DEXTRO 
     10          |       or its distributors.
     11          |
     12          |       Este código é propriedade da DEXTRO  e não pode ser copiado, em parte 
     13          |       ou em todo, ou utilizado, exceto quando for legalmente licenciado pela 
     14          |       DEXTRO  ou por um de seus distribuidores.
     15          | __________________________________________________________________________________
     16          |
     17          |       Arquivo            :  menu_edita_inteiro.c
     18          |       Descrição          :  Tela para realizar a edição de números inteiros
     19          | 
     20          |       Autor              :  Marcos Aquino
     21          |       Data criação       :  07/11/2016
     22          |
     23          |       Revisões           :  1.0.0.0
     24          |
     25          |
     26          | __________________________________________________________________________________
     27          */
     28          
     29          /***********************************************************************************
     30          *       Includes
     31          ***********************************************************************************/
     32          #include <stdio.h>
     33          #include <stdlib.h>
     34          #include <string.h>
     35          #include "menu_edita_inteiro.h"
     36          #include "..\includes.h"
     37          
     38          /***********************************************************************************
     39          *       Constantes
     40          ***********************************************************************************/
     41          
     42          
     43          /***********************************************************************************
     44          *       Variaveis locais
     45          ***********************************************************************************/
     46          
     47          
     48          /***********************************************************************************
     49          *       Funções locais
     50          ***********************************************************************************/
     51          
     52          
     53          /***********************************************************************************
     54          *       Implementação das funções
     55          ***********************************************************************************/
     56          
     57          /***********************************************************************************
     58          *       Descrição       :       Ponto de entrada do menu de edição
     59          *                               de inteiro
     60          *       Parametro       :       (char*) titulo
     61          *                               (char*) String de formação
     62          *                               (unsigned int) valor inicial
     63          *                               (unsigned int) valor mínimo
     64          *                               (unsigned int) valor máximo
     65          *       Retorno         :       (unsigned int) valor editado
     66          ***********************************************************************************/

   \                                 In section .text, align 2, keep-with-next
     67          unsigned int MEI_entry(char *titulo,char* strFmt,unsigned int inicial,
     68                                 unsigned int minimo,unsigned int maximo){
   \                     MEI_entry:
   \   00000000   0xE92D 0x41F0      PUSH     {R4-R8,LR}
   \   00000004   0xB086             SUB      SP,SP,#+24
   \   00000006   0x0004             MOVS     R4,R0
   \   00000008   0x000D             MOVS     R5,R1
   \   0000000A   0x0016             MOVS     R6,R2
   \   0000000C   0x001F             MOVS     R7,R3
     69            eTECLA tecla;
     70            char linha[17];
     71            unsigned char tam;
     72            
     73            tam = strlen(titulo);
   \   0000000E   0x0020             MOVS     R0,R4
   \   00000010   0x.... 0x....      BL       strlen
   \   00000014   0x4680             MOV      R8,R0
     74            
     75            HD44780_clearText();
   \   00000016   0x200C             MOVS     R0,#+12
   \   00000018   0x.... 0x....      BL       HD44780_writeChar
     76            HD44780_posicionaTexto((16-tam)>>1,0);
   \   0000001C   0x2100             MOVS     R1,#+0
   \   0000001E   0xFA5F 0xF888      UXTB     R8,R8            ;; ZeroExt  R8,R8,#+24,#+24
   \   00000022   0xF1D8 0x0010      RSBS     R0,R8,#+16
   \   00000026   0x1040             ASRS     R0,R0,#+1
   \   00000028   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   0000002A   0x.... 0x....      BL       HD44780_posicionaTexto
     77            HD44780_writeString(titulo);
   \   0000002E   0x0020             MOVS     R0,R4
   \   00000030   0x.... 0x....      BL       HD44780_writeString
   \   00000034   0x9C0C             LDR      R4,[SP, #+48]
   \   00000036   0xE01A             B.N      ??MEI_entry_0
     78            
     79            for(;TECLADO_getContadorInatividade();){
     80                   
     81              tecla = TECLADO_getch();
     82              switch(tecla){
     83                case TECLA_ENTER:
     84                case TECLA_ESC:
     85                     return inicial;
     86                case TECLA_INC:
     87                     if(inicial<maximo)
     88                       inicial++;
     89                     break;
     90                case TECLA_DEC:
     91                     if(inicial>minimo)
   \                     ??MEI_entry_1:
   \   00000038   0x42B7             CMP      R7,R6
   \   0000003A   0xD200             BCS.N    ??MEI_entry_2
     92                       inicial--;
   \   0000003C   0x1E76             SUBS     R6,R6,#+1
     93                     break;
     94              }
     95              
     96              sprintf(linha,strFmt,inicial);
   \                     ??MEI_entry_2:
   \                     ??MEI_entry_3:
   \   0000003E   0x0032             MOVS     R2,R6
   \   00000040   0x0029             MOVS     R1,R5
   \   00000042   0xA800             ADD      R0,SP,#+0
   \   00000044   0x.... 0x....      BL       sprintf
     97              tam = strlen(linha);
   \   00000048   0xA800             ADD      R0,SP,#+0
   \   0000004A   0x.... 0x....      BL       strlen
   \   0000004E   0x4680             MOV      R8,R0
     98              HD44780_posicionaTexto((16-tam)>>1,1);
   \   00000050   0x2101             MOVS     R1,#+1
   \   00000052   0xFA5F 0xF888      UXTB     R8,R8            ;; ZeroExt  R8,R8,#+24,#+24
   \   00000056   0xF1D8 0x0010      RSBS     R0,R8,#+16
   \   0000005A   0x1040             ASRS     R0,R0,#+1
   \   0000005C   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   0000005E   0x.... 0x....      BL       HD44780_posicionaTexto
     99              HD44780_writeString(linha);
   \   00000062   0xA800             ADD      R0,SP,#+0
   \   00000064   0x.... 0x....      BL       HD44780_writeString
    100              
    101              vTaskDelay(50);
   \   00000068   0x2032             MOVS     R0,#+50
   \   0000006A   0x.... 0x....      BL       vTaskDelay
   \                     ??MEI_entry_0:
   \   0000006E   0x.... 0x....      BL       TECLADO_getContadorInatividade
   \   00000072   0x2800             CMP      R0,#+0
   \   00000074   0xD010             BEQ.N    ??MEI_entry_4
   \   00000076   0x.... 0x....      BL       TECLADO_getch
   \   0000007A   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   0000007C   0x2801             CMP      R0,#+1
   \   0000007E   0xD005             BEQ.N    ??MEI_entry_5
   \   00000080   0xD3DD             BCC.N    ??MEI_entry_3
   \   00000082   0x2803             CMP      R0,#+3
   \   00000084   0xD0D8             BEQ.N    ??MEI_entry_1
   \   00000086   0xD303             BCC.N    ??MEI_entry_6
   \   00000088   0x2804             CMP      R0,#+4
   \   0000008A   0xD1D8             BNE.N    ??MEI_entry_3
   \                     ??MEI_entry_5:
   \   0000008C   0x0030             MOVS     R0,R6
   \   0000008E   0xE004             B.N      ??MEI_entry_7
   \                     ??MEI_entry_6:
   \   00000090   0x42A6             CMP      R6,R4
   \   00000092   0xD200             BCS.N    ??MEI_entry_8
   \   00000094   0x1C76             ADDS     R6,R6,#+1
   \                     ??MEI_entry_8:
   \   00000096   0xE7D2             B.N      ??MEI_entry_3
    102            }                        
    103                                   
    104            return inicial;                         
   \                     ??MEI_entry_4:
   \   00000098   0x0030             MOVS     R0,R6
   \                     ??MEI_entry_7:
   \   0000009A   0xB006             ADD      SP,SP,#+24
   \   0000009C   0xE8BD 0x81F0      POP      {R4-R8,PC}       ;; return
    105          }
    106          /***********************************************************************************
    107          *       Descrição       :       Ponto de entrada do menu de edição
    108          *                               de inteiro
    109          *       Parametro       :       (char*) titulo
    110          *                               (char*) String de formação
    111          *                               (unsigned int) valor inicial
    112          *                               (unsigned int) valor mínimo
    113          *                               (unsigned int) valor máximo
    114          *       Retorno         :       (unsigned int) valor editado
    115          ***********************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    116          unsigned int MEI_entry_inc(char *titulo,char* strFmt,unsigned int inicial,
    117                                     unsigned int minimo,unsigned int maximo,unsigned int incremento){
   \                     MEI_entry_inc:
   \   00000000   0xE92D 0x43F0      PUSH     {R4-R9,LR}
   \   00000004   0xB085             SUB      SP,SP,#+20
   \   00000006   0x0007             MOVS     R7,R0
   \   00000008   0x000C             MOVS     R4,R1
   \   0000000A   0x0016             MOVS     R6,R2
   \   0000000C   0x001D             MOVS     R5,R3
    118            eTECLA tecla;
    119            char linha[17];
    120            unsigned char tam;
    121            
    122            tam = strlen(titulo);
   \   0000000E   0x0038             MOVS     R0,R7
   \   00000010   0x.... 0x....      BL       strlen
   \   00000014   0x4681             MOV      R9,R0
    123            
    124            HD44780_clearText();
   \   00000016   0x200C             MOVS     R0,#+12
   \   00000018   0x.... 0x....      BL       HD44780_writeChar
    125            HD44780_posicionaTexto((16-tam)>>1,0);
   \   0000001C   0x2100             MOVS     R1,#+0
   \   0000001E   0xFA5F 0xF989      UXTB     R9,R9            ;; ZeroExt  R9,R9,#+24,#+24
   \   00000022   0xF1D9 0x0010      RSBS     R0,R9,#+16
   \   00000026   0x1040             ASRS     R0,R0,#+1
   \   00000028   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   0000002A   0x.... 0x....      BL       HD44780_posicionaTexto
    126            HD44780_writeString(titulo);
   \   0000002E   0x0038             MOVS     R0,R7
   \   00000030   0x.... 0x....      BL       HD44780_writeString
   \   00000034   0x9F0C             LDR      R7,[SP, #+48]
   \   00000036   0xF8DD 0x8034      LDR      R8,[SP, #+52]
   \   0000003A   0xE01B             B.N      ??MEI_entry_inc_0
    127            
    128            for(;TECLADO_getContadorInatividade();){
    129                   
    130              tecla = TECLADO_getch();
    131              switch(tecla){
    132                case TECLA_ENTER:
    133                case TECLA_ESC:
    134                     return inicial;
    135                case TECLA_INC:
    136                     if(inicial<maximo)
    137                       inicial+=incremento;
    138                     break;
    139                case TECLA_DEC:
    140                     if(inicial>minimo)
   \                     ??MEI_entry_inc_1:
   \   0000003C   0x42B5             CMP      R5,R6
   \   0000003E   0xD201             BCS.N    ??MEI_entry_inc_2
    141                       inicial-=incremento;
   \   00000040   0xEBB6 0x0608      SUBS     R6,R6,R8
    142                     break;
    143              }
    144              
    145              sprintf(linha,strFmt,inicial);
   \                     ??MEI_entry_inc_2:
   \                     ??MEI_entry_inc_3:
   \   00000044   0x0032             MOVS     R2,R6
   \   00000046   0x0021             MOVS     R1,R4
   \   00000048   0xA800             ADD      R0,SP,#+0
   \   0000004A   0x.... 0x....      BL       sprintf
    146              tam = strlen(linha);
   \   0000004E   0xA800             ADD      R0,SP,#+0
   \   00000050   0x.... 0x....      BL       strlen
   \   00000054   0x4681             MOV      R9,R0
    147              HD44780_posicionaTexto((16-tam)>>1,1);
   \   00000056   0x2101             MOVS     R1,#+1
   \   00000058   0xFA5F 0xF989      UXTB     R9,R9            ;; ZeroExt  R9,R9,#+24,#+24
   \   0000005C   0xF1D9 0x0010      RSBS     R0,R9,#+16
   \   00000060   0x1040             ASRS     R0,R0,#+1
   \   00000062   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   00000064   0x.... 0x....      BL       HD44780_posicionaTexto
    148              HD44780_writeString(linha);
   \   00000068   0xA800             ADD      R0,SP,#+0
   \   0000006A   0x.... 0x....      BL       HD44780_writeString
    149              
    150              vTaskDelay(50);
   \   0000006E   0x2032             MOVS     R0,#+50
   \   00000070   0x.... 0x....      BL       vTaskDelay
   \                     ??MEI_entry_inc_0:
   \   00000074   0x.... 0x....      BL       TECLADO_getContadorInatividade
   \   00000078   0x2800             CMP      R0,#+0
   \   0000007A   0xD011             BEQ.N    ??MEI_entry_inc_4
   \   0000007C   0x.... 0x....      BL       TECLADO_getch
   \   00000080   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   00000082   0x2801             CMP      R0,#+1
   \   00000084   0xD005             BEQ.N    ??MEI_entry_inc_5
   \   00000086   0xD3DD             BCC.N    ??MEI_entry_inc_3
   \   00000088   0x2803             CMP      R0,#+3
   \   0000008A   0xD0D7             BEQ.N    ??MEI_entry_inc_1
   \   0000008C   0xD303             BCC.N    ??MEI_entry_inc_6
   \   0000008E   0x2804             CMP      R0,#+4
   \   00000090   0xD1D8             BNE.N    ??MEI_entry_inc_3
   \                     ??MEI_entry_inc_5:
   \   00000092   0x0030             MOVS     R0,R6
   \   00000094   0xE005             B.N      ??MEI_entry_inc_7
   \                     ??MEI_entry_inc_6:
   \   00000096   0x42BE             CMP      R6,R7
   \   00000098   0xD201             BCS.N    ??MEI_entry_inc_8
   \   0000009A   0xEB18 0x0606      ADDS     R6,R8,R6
   \                     ??MEI_entry_inc_8:
   \   0000009E   0xE7D1             B.N      ??MEI_entry_inc_3
    151            }                        
    152                                   
    153            return inicial;                         
   \                     ??MEI_entry_inc_4:
   \   000000A0   0x0030             MOVS     R0,R6
   \                     ??MEI_entry_inc_7:
   \   000000A2   0xB005             ADD      SP,SP,#+20
   \   000000A4   0xE8BD 0x83F0      POP      {R4-R9,PC}       ;; return
    154          }
    155          /***********************************************************************************
    156          *       Fim do arquivo
    157          ***********************************************************************************/
    158          
    159          
    160          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      48   MEI_entry
        48   -> HD44780_posicionaTexto
        48   -> HD44780_writeChar
        48   -> HD44780_writeString
        48   -> TECLADO_getContadorInatividade
        48   -> TECLADO_getch
        48   -> sprintf
        48   -> strlen
        48   -> vTaskDelay
      48   MEI_entry_inc
        48   -> HD44780_posicionaTexto
        48   -> HD44780_writeChar
        48   -> HD44780_writeString
        48   -> TECLADO_getContadorInatividade
        48   -> TECLADO_getch
        48   -> sprintf
        48   -> strlen
        48   -> vTaskDelay


   Section sizes:

   Bytes  Function/Label
   -----  --------------
     160  MEI_entry
     168  MEI_entry_inc

 
 328 bytes in section .text
 
 328 bytes of CODE memory

Errors: none
Warnings: none
