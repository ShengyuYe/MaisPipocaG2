###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.50.3.4676/W32 for ARM      06/Jul/2017  16:39:33 #
# Copyright 1999-2013 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Aplicacao\menu_rolagem.c                  #
#    Command line =  C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Aplicacao\menu_rolagem.c -lC              #
#                    C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\List\ -lA                           #
#                    C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\List\ -o                            #
#                    C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\Obj\ --no_cse --no_unroll           #
#                    --no_inline --no_code_motion --no_tbaa --no_clustering   #
#                    --no_scheduling --debug --endian=little --cpu=Cortex-M3  #
#                    -e --fpu=None --dlib_config "C:\Program Files (x86)\IAR  #
#                    Systems\Embedded Workbench 6.5\arm\INC\c\DLib_Config_Nor #
#                    mal.h" -Ol                                               #
#    List file    =  C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\List\menu_rolagem.lst               #
#    Object file  =  C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPip #
#                    ocaG2\SOFTWARE\Debug\Obj\menu_rolagem.o                  #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\Marcos\Dropbox\Reps\Dextro\IBA\Hardware\MaisPipocaG2\SOFTWARE\Aplicacao\menu_rolagem.c
      1          /*__________________________________________________________________________________
      2          |	DEXTRO SOLUÇÕES TECNOLÓGICAS
      3          |       
      4          |       ITAJAÍ - SC
      5          |       www.dextro.ind.br
      6          | __________________________________________________________________________________
      7          |
      8          |       This source code was developed by DEXTRO  and cannot be copied, in part 
      9          |       or in whole, or used, except when legally licensed by DEXTRO 
     10          |       or its distributors.
     11          |
     12          |       Este código é propriedade da DEXTRO  e não pode ser copiado, em parte 
     13          |       ou em todo, ou utilizado, exceto quando for legalmente licenciado pela 
     14          |       DEXTRO  ou por um de seus distribuidores.
     15          | __________________________________________________________________________________
     16          |
     17          |       Arquivo            :  menu_rolagem.c
     18          |       Descrição          :  implementa um menu de rolagem no 
     19          |                             LCD de caracteres
     20          | 
     21          |       Autor              :  Marcos Aquino
     22          |       Data criação       :  07/11/2016
     23          |
     24          |       Revisões           :  1.0.0.0
     25          |
     26          |
     27          | __________________________________________________________________________________
     28          */
     29          
     30          /***********************************************************************************
     31          *       Includes
     32          ***********************************************************************************/
     33          #include <stdio.h>
     34          #include <stdlib.h>
     35          #include <string.h>
     36          #include "menu_rolagem.h"
     37          #include "..\includes.h"
     38          
     39          /***********************************************************************************
     40          *       Definições locais
     41          ***********************************************************************************/
     42          
     43          /***********************************************************************************
     44          *       Constantes locais
     45          ***********************************************************************************/
     46          
     47          /***********************************************************************************
     48          *       Variaveis locais
     49          ***********************************************************************************/
     50          
     51          /***********************************************************************************
     52          *       Funções locais
     53          ***********************************************************************************/
     54          
     55          
     56          /***********************************************************************************
     57          *       Implementação das funções
     58          ***********************************************************************************/
     59          
     60          /***********************************************************************************
     61          *       Descrição       :       Implementação do menu de rolagem
     62          *       Parametros      :       (
     63          *       Retorno         :       nenhum
     64          ***********************************************************************************/

   \                                 In section .text, align 2, keep-with-next
     65          void MENUROLAGEM_show(char* titulo,char** opcoes,unsigned short int tam_opcoes,
     66                                void(*funcs[])(void)){
   \                     MENUROLAGEM_show:
   \   00000000   0xE92D 0x43F8      PUSH     {R3-R9,LR}
   \   00000004   0x0004             MOVS     R4,R0
   \   00000006   0x000D             MOVS     R5,R1
   \   00000008   0x0016             MOVS     R6,R2
   \   0000000A   0x001F             MOVS     R7,R3
     67            eTECLA tecla;
     68            unsigned short int indice=0;
   \   0000000C   0xF05F 0x0900      MOVS     R9,#+0
     69            unsigned char tam = strlen(titulo);
   \   00000010   0x0020             MOVS     R0,R4
   \   00000012   0x.... 0x....      BL       strlen
   \   00000016   0x4680             MOV      R8,R0
     70            
     71            HD44780_clearText();
   \   00000018   0x200C             MOVS     R0,#+12
   \   0000001A   0x.... 0x....      BL       HD44780_writeChar
     72            HD44780_posicionaTexto((16-tam)>>1,0);
   \   0000001E   0x2100             MOVS     R1,#+0
   \   00000020   0xFA5F 0xF888      UXTB     R8,R8            ;; ZeroExt  R8,R8,#+24,#+24
   \   00000024   0xF1D8 0x0010      RSBS     R0,R8,#+16
   \   00000028   0x1040             ASRS     R0,R0,#+1
   \   0000002A   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   0000002C   0x.... 0x....      BL       HD44780_posicionaTexto
     73            HD44780_writeString(titulo);
   \   00000030   0x0020             MOVS     R0,R4
   \   00000032   0x.... 0x....      BL       HD44780_writeString
   \   00000036   0xE004             B.N      ??MENUROLAGEM_show_0
     74            
     75            for(;TECLADO_getContadorInatividade();){
     76              
     77              HD44780_posicionaTexto((16-tam)>>1,0);
     78              HD44780_writeString(titulo);
     79              HD44780_posicionaTexto(0,1);
     80              HD44780_writeString(opcoes[indice]);
     81              
     82              tecla = TECLADO_getch();
     83              switch(tecla){
     84                case TECLA_ENTER:
     85                     if(funcs[indice]!=NULL){
     86                       funcs[indice]();
     87                       HD44780_clearText();
     88                     }
     89                     else
     90                       if(indice==(tam_opcoes-1))
     91                         return;
     92                     break;
     93                case TECLA_ESC:
     94                     return;
     95                case TECLA_INC:
     96                     indice = (indice+1) % tam_opcoes;
     97                     break;
     98                case TECLA_DEC:
     99                     if(indice)
    100                       indice--;
    101                     else
    102                       indice = tam_opcoes-1;
   \                     ??MENUROLAGEM_show_1:
   \   00000038   0xF1B6 0x0901      SUBS     R9,R6,#+1
    103                     break;
    104              }
    105                  
    106              vTaskDelay(50);
   \                     ??MENUROLAGEM_show_2:
   \                     ??MENUROLAGEM_show_3:
   \   0000003C   0x2032             MOVS     R0,#+50
   \   0000003E   0x.... 0x....      BL       vTaskDelay
   \                     ??MENUROLAGEM_show_0:
   \   00000042   0x.... 0x....      BL       TECLADO_getContadorInatividade
   \   00000046   0x2800             CMP      R0,#+0
   \   00000048   0xD049             BEQ.N    ??MENUROLAGEM_show_4
   \   0000004A   0x2100             MOVS     R1,#+0
   \   0000004C   0xFA5F 0xF888      UXTB     R8,R8            ;; ZeroExt  R8,R8,#+24,#+24
   \   00000050   0xF1D8 0x0010      RSBS     R0,R8,#+16
   \   00000054   0x1040             ASRS     R0,R0,#+1
   \   00000056   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   00000058   0x.... 0x....      BL       HD44780_posicionaTexto
   \   0000005C   0x0020             MOVS     R0,R4
   \   0000005E   0x.... 0x....      BL       HD44780_writeString
   \   00000062   0x2101             MOVS     R1,#+1
   \   00000064   0x2000             MOVS     R0,#+0
   \   00000066   0x.... 0x....      BL       HD44780_posicionaTexto
   \   0000006A   0xFA1F 0xF989      UXTH     R9,R9            ;; ZeroExt  R9,R9,#+16,#+16
   \   0000006E   0xF855 0x0029      LDR      R0,[R5, R9, LSL #+2]
   \   00000072   0x.... 0x....      BL       HD44780_writeString
   \   00000076   0x.... 0x....      BL       TECLADO_getch
   \   0000007A   0xB2C0             UXTB     R0,R0            ;; ZeroExt  R0,R0,#+24,#+24
   \   0000007C   0x2801             CMP      R0,#+1
   \   0000007E   0xD01B             BEQ.N    ??MENUROLAGEM_show_5
   \   00000080   0xD3DC             BCC.N    ??MENUROLAGEM_show_3
   \   00000082   0x2803             CMP      R0,#+3
   \   00000084   0xD023             BEQ.N    ??MENUROLAGEM_show_6
   \   00000086   0xD318             BCC.N    ??MENUROLAGEM_show_7
   \   00000088   0x2804             CMP      R0,#+4
   \   0000008A   0xD1D7             BNE.N    ??MENUROLAGEM_show_3
   \                     ??MENUROLAGEM_show_8:
   \   0000008C   0xFA1F 0xF989      UXTH     R9,R9            ;; ZeroExt  R9,R9,#+16,#+16
   \   00000090   0xF857 0x0029      LDR      R0,[R7, R9, LSL #+2]
   \   00000094   0x2800             CMP      R0,#+0
   \   00000096   0xD008             BEQ.N    ??MENUROLAGEM_show_9
   \   00000098   0xFA1F 0xF989      UXTH     R9,R9            ;; ZeroExt  R9,R9,#+16,#+16
   \   0000009C   0xF857 0x0029      LDR      R0,[R7, R9, LSL #+2]
   \   000000A0   0x4780             BLX      R0
   \   000000A2   0x200C             MOVS     R0,#+12
   \   000000A4   0x.... 0x....      BL       HD44780_writeChar
   \                     ??MENUROLAGEM_show_10:
   \   000000A8   0xE7C8             B.N      ??MENUROLAGEM_show_3
   \                     ??MENUROLAGEM_show_9:
   \   000000AA   0xFA1F 0xF989      UXTH     R9,R9            ;; ZeroExt  R9,R9,#+16,#+16
   \   000000AE   0xB2B6             UXTH     R6,R6            ;; ZeroExt  R6,R6,#+16,#+16
   \   000000B0   0x1E70             SUBS     R0,R6,#+1
   \   000000B2   0x4581             CMP      R9,R0
   \   000000B4   0xD1F8             BNE.N    ??MENUROLAGEM_show_10
   \   000000B6   0xE012             B.N      ??MENUROLAGEM_show_11
   \                     ??MENUROLAGEM_show_5:
   \   000000B8   0xE011             B.N      ??MENUROLAGEM_show_11
   \                     ??MENUROLAGEM_show_7:
   \   000000BA   0xFA1F 0xF989      UXTH     R9,R9            ;; ZeroExt  R9,R9,#+16,#+16
   \   000000BE   0xF119 0x0001      ADDS     R0,R9,#+1
   \   000000C2   0xB2B6             UXTH     R6,R6            ;; ZeroExt  R6,R6,#+16,#+16
   \   000000C4   0xFB90 0xF1F6      SDIV     R1,R0,R6
   \   000000C8   0xFB06 0x0911      MLS      R9,R6,R1,R0
   \   000000CC   0xE7B6             B.N      ??MENUROLAGEM_show_3
   \                     ??MENUROLAGEM_show_6:
   \   000000CE   0xFA1F 0xF989      UXTH     R9,R9            ;; ZeroExt  R9,R9,#+16,#+16
   \   000000D2   0xF1B9 0x0F00      CMP      R9,#+0
   \   000000D6   0xD0AF             BEQ.N    ??MENUROLAGEM_show_1
   \   000000D8   0xF1B9 0x0901      SUBS     R9,R9,#+1
   \   000000DC   0xE7AE             B.N      ??MENUROLAGEM_show_2
    107            }  
    108          }
   \                     ??MENUROLAGEM_show_4:
   \                     ??MENUROLAGEM_show_11:
   \   000000DE   0xE8BD 0x83F1      POP      {R0,R4-R9,PC}    ;; return
    109          /***********************************************************************************
    110          *       Fim do arquivo
    111          ***********************************************************************************/

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      32   MENUROLAGEM_show
        32   -- Indirect call
        32   -> HD44780_posicionaTexto
        32   -> HD44780_writeChar
        32   -> HD44780_writeString
        32   -> TECLADO_getContadorInatividade
        32   -> TECLADO_getch
        32   -> strlen
        32   -> vTaskDelay


   Section sizes:

   Bytes  Function/Label
   -----  --------------
     226  MENUROLAGEM_show

 
 226 bytes in section .text
 
 226 bytes of CODE memory

Errors: none
Warnings: none
